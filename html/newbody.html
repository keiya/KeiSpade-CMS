<section><h2>Writing Newpage</h2>
<script type="text/javascript">
	<!--
	var mode = 0;
	function setPagename(frm) {
			//if (frm.elements["title"].value == ""){
			
			//} else {
				var pagename = document.editform.title.value;
				frm.action="./<TMPL_VAR NAME=ScriptName>?cmd=newpost&page="+pagename;
				frm.submit()
			//}
	}
	function previewToggle() {
		if (mode == 0) {
			mode = 1;
			var fm=document.getElementById("edit");
			fm.style.display = "none";
			var res=document.getElementById("result");
			res.style.display = "block";
			document.getElementById("prevbtn").innerHTML = "Back to edit";
			var body = document.editform.body.value;
			$("result").innerHTML = "Loading...";
			var httpObj = createXMLHttpRequest();
			if (httpObj) {
				httpObj.open("POST","./<TMPL_VAR NAME=ScriptName>?cmd=preview",true);
				httpObj.send("body="+encodeURIComponent(body));
				httpObj.onreadystatechange = function() {
					//readyState値は4で受信完了
					if (httpObj.readyState==4) {
						//コールバック
						on_loaded(httpObj)
					}
				}
	
				//コールバック関数 ( 受信時に実行されます )
				function on_loaded(obj) {
					//レスポンスを取得
					var res  = obj.responseText //[6]
					$("result").innerHTML = res;
				}
			}
		}
		else if (mode == 1) {
			mode = 0;
			var fm=document.getElementById("edit");
			fm.style.display = "block";
			var res=document.getElementById("result");
			res.style.display = "none";
			document.getElementById("prevbtn").innerHTML = "Preview again";
		}
		return;
	}
	// -->

</script>
<button value="Preview" name="prev" id="prevbtn" type="button" onclick="previewToggle()">Preview</button>
<form action="./<TMPL_VAR NAME=ScriptName>?cmd=newpost" method="post" name="editform" id="edit" accept-charset="utf-8">
<input type="hidden" value="<TMPL_VAR NAME=Token>" name="token">
Title:<br />
<input type="text" name="title" placeholder="Newpage Name"><br />
Body:<br />
<textarea name="body" rows="20" cols="80" placeholder="Write!">
</textarea><br />
<button value="Post" name="bodysend" type="button" onClick="return setPagename(this.form)">Post</button>
</form>
<div id="result"></div>
</section>

